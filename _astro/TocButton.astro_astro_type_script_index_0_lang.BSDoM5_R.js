let t=null,d=null,l=!1,c=null,n=null,q=null,b=null,E=null;function w(){document.querySelectorAll("#toc-modal").forEach(e=>e.remove()),document.querySelectorAll("#toc-container").forEach(e=>e.remove()),l=!1}function J(){let e=document.getElementById("toc-anchor");return e||(e=document.getElementById("post-container"),e)||(e=document.querySelector(".card-base"),e)||(e=document.querySelector("main")),e}function z(){if(t){if(d=document.querySelector("#toc"),!d){t.classList.add("hidden"),l&&w();return}b=d.querySelectorAll('a[href^="#"]'),Y(),!b.length&&l&&w()}}function H(){if(!c||!n)return;const e=t?.querySelector("svg");l=!1,e?.classList.remove("rotate-180"),t?.classList.remove("bg-[var(--btn-regular-bg-active)]"),c.classList.remove("opacity-100"),c.classList.add("opacity-0"),requestAnimationFrame(()=>{n.classList.remove("translate-x-0"),n.classList.add("translate-x-full"),setTimeout(()=>{c?.remove(),n?.remove(),c=null,n=null},200)})}function Y(){if(!t)return;const e=J();if(!e||!b){t.classList.add("hidden");return}if(b.length===0){t.classList.add("hidden");return}const A=e.getBoundingClientRect(),S=A.top<window.innerHeight-80&&A.bottom>80,F=A.top<0;S&&F?(t.classList.remove("hidden"),l||t.querySelector("svg")?.classList.remove("rotate-180")):(t.classList.add("hidden"),l&&w())}function K(){R(),E=Y,window.addEventListener("scroll",E)}function R(){E&&(window.removeEventListener("scroll",E),E=null)}function k(){q&&(q.disconnect(),q=null),b=null,t=document.getElementById("toc-button"),d=document.querySelector("#toc"),t&&(z(),d&&(q=new MutationObserver(()=>{b=null,z()}),q.observe(d,{childList:!0,subtree:!0})),t.removeEventListener("click",D),t.addEventListener("click",D),K(),Y())}function D(){w(),d=document.querySelector("#toc");const e=t?.querySelector("svg");if(!(d&&d.querySelectorAll('a[href^="#"]').length>0)){l=!1;return}if(l)H();else{e?.classList.add("rotate-180"),c=document.createElement("div"),c.className="fixed inset-0 bg-black/50 z-40 lg:hidden opacity-0",c.id="toc-modal",n=document.createElement("div"),n.className="fixed top-[calc(5.5rem+4rem)] right-0 min-w-[12rem] max-w-[16rem] z-50 lg:hidden translate-x-full rounded-xl overflow-hidden bg-white/90 dark:bg-[#1a1a1a]/90 backdrop-blur-sm shadow-lg",n.id="toc-container";const F=d.cloneNode(!0),i=document.createElement("div");i.className="toc-content-wrapper hide-scrollbar",i.style.maxHeight="calc(6 * 2rem + 5 * 0.5rem + 2rem)",i.style.overflowY="auto",i.style.overscrollBehavior="contain",i.appendChild(F),n.appendChild(i),document.body.appendChild(c),document.body.appendChild(n),i.addEventListener("wheel",o=>{const{scrollTop:u,scrollHeight:p,clientHeight:v}=i;(u<=0&&o.deltaY<0||u+v>=p&&o.deltaY>0)&&o.preventDefault(),o.stopPropagation(),requestAnimationFrame(()=>{S(!0)})},{passive:!1});let I=0;i.addEventListener("touchstart",o=>{I=o.touches[0].clientY},{passive:!0}),i.addEventListener("touchmove",o=>{const u=o.touches[0].clientY,{scrollTop:p,scrollHeight:v,clientHeight:s}=i;(p<=0&&u>I||p+s>=v&&u<I)&&o.preventDefault(),o.stopPropagation(),requestAnimationFrame(()=>{S(!0)})},{passive:!1}),requestAnimationFrame(()=>{c.classList.remove("opacity-0"),c.classList.add("opacity-100"),n.classList.remove("translate-x-full"),n.classList.add("translate-x-0")}),c.addEventListener("click",H),l=!0;const C=n.querySelector("table-of-contents");if(C){let o=function(x=!1){if(!l)return;let h=-1,f=1/0;const T=window.scrollY,P=window.innerHeight;u.forEach((a,g)=>{const y=a.getBoundingClientRect(),B=y.top+T,r=Math.abs(B-T);y.top>-50&&y.top<P&&r<f&&(f=r,h=g)}),h===-1&&u.forEach((a,g)=>{const B=a.getBoundingClientRect().top+T,r=Math.abs(B-T);r<f&&(f=r,h=g)});let V=!1;p.forEach(a=>{const g=a.getAttribute("href");if(g){const y=g.substring(1);if(v.get(y)===h){V=!0,a.classList.add("visible");const r=a.getBoundingClientRect(),L=n.getBoundingClientRect(),W=r.top-L.top,j=r.height;requestAnimationFrame(()=>{if(x){const $=a.getBoundingClientRect(),G=$.top-L.top;s.style.top=`${G}px`,s.style.height=`${$.height}px`}else s.style.top=`${W}px`,s.style.height=`${j}px`;s.style.display=""}),!x&&(r.top<L.top||r.bottom>L.bottom)&&a.scrollIntoView({behavior:"smooth",block:r.top<L.top?"start":"end"})}else a.classList.remove("visible")}}),!V&&h===-1&&(s.style.display="none")};var S=o;const u=Array.from(document.querySelectorAll("h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]")),p=Array.from(C.querySelectorAll('a[href^="#"]')),v=new Map;u.forEach((x,h)=>{const f=x.getAttribute("id");f&&v.set(f,h)});let s=document.createElement("div");s.className="-z-10 absolute bg-[var(--toc-btn-hover)] left-0 right-0 rounded-xl transition-all border-2 border-[var(--toc-btn-hover)] border-dashed",s.style.display="none";const M=C.querySelector("ul,ol");M?M.appendChild(s):C.appendChild(s),i.addEventListener("scroll",()=>{requestAnimationFrame(()=>{o(!0)})},{passive:!0});let m=null;const N=()=>{l&&(m&&window.cancelAnimationFrame(m),m=requestAnimationFrame(()=>{o(),m=null}))};window.addEventListener("scroll",N,{passive:!0}),requestAnimationFrame(o);const O=H;H=()=>{m&&(window.cancelAnimationFrame(m),m=null),window.removeEventListener("scroll",N),O()}}}}k();window.swup?window.swup.hooks.on("content:replace",()=>{w(),R(),t?.querySelector("svg")?.classList.remove("rotate-180"),l=!1,setTimeout(k,100)}):document.addEventListener("swup:enable",()=>{window.swup.hooks.on("content:replace",()=>{w(),R(),t?.querySelector("svg")?.classList.remove("rotate-180"),l=!1,setTimeout(k,100)})});
